<li>
  <%= link_to lead_path(lead), class: "block hover:bg-gray-50" do %>
    <div class="px-4 py-4 sm:px-6">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center">
            <p class="text-sm font-medium text-indigo-600 truncate"><%= lead.title %></p>
            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= lead.won? ? 'bg-green-100 text-green-800' : lead.lost? ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800' %>">
              <%= lead.status.humanize %>
            </span>
            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
              <%= lead.source.humanize %>
            </span>
          </div>
          <div class="mt-2 sm:flex sm:justify-between">
            <div class="sm:flex">
              <p class="flex items-center text-sm text-gray-500">
                <%= lead.customer.name %>
              </p>
              <% if lead.assigned_to.present? %>
                <p class="mt-2 flex items-center text-sm text-gray-500 sm:mt-0 sm:ml-6">
                  Assigned to: <%= lead.assigned_to.name %>
                </p>
              <% end %>
            </div>
            <div class="mt-2 flex items-center text-sm text-gray-500 sm:mt-0">
              <% if lead.due_at.present? %>
                <p class="<%= lead.overdue? ? 'text-red-600 font-semibold' : lead.due_soon? ? 'text-orange-600' : '' %>">
                  Due: <%= lead.due_at.strftime("%b %d, %Y") %>
                </p>
              <% end %>
            </div>
          </div>
          <% if lead.followups.upcoming.any? %>
            <div class="mt-2 text-xs text-gray-500">
              <span class="font-medium"><%= lead.followups.upcoming.count %> upcoming followup(s)</span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <% if policy(lead).change_assignee? || policy(lead).update? %>
    <div class="px-4 py-2 bg-gray-50 flex space-x-2 border-t">
      <% if policy(lead).change_assignee? %>
        <button type="button" onclick="event.stopPropagation(); openAssignmentModal('<%= "assignment_modal_#{lead.class.name.demodulize.underscore}_#{lead.id}" %>')" class="bg-indigo-600 text-white px-3 py-1 rounded text-sm">Assign</button>
        <%= render 'forefront/assignments/form', assignable: lead, admins: @admins %>
      <% end %>
      <% if policy(lead).update? %>
        <button type="button" onclick="event.stopPropagation(); openFollowupModal('<%= "followup_modal_#{lead.class.name.demodulize.underscore}_#{lead.id}" %>')" class="bg-green-600 text-white px-3 py-1 rounded text-sm">+ Followup</button>
        <%= render 'forefront/followups/form', followupable: lead %>
      <% end %>
    </div>
  <% end %>

</li>