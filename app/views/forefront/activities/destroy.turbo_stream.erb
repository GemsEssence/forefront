<%= turbo_stream.remove "activity_#{@activity.id}" %>

<%= turbo_stream.append "flash_messages" do %>
  <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline">Activity was successfully deleted.</span>
    <button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.remove()">
      <span class="sr-only">Dismiss</span>
      <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
<% end %>

<%# Update tab counts after deletion %>
<% remaining_activities = @actable.activities.recent %>
<% comments_remarks_count = remaining_activities.select { |a| a.comment? || a.remark? }.count %>
<% next_steps_count = remaining_activities.select { |a| a.next_step? }.count %>
<% internal_notes_count = remaining_activities.select { |a| a.internal_note? }.count %>

<%= turbo_stream.replace "tab_comments_remarks_#{@actable.id}" do %>
  <button onclick="showTab('comments_remarks_<%= @actable.id %>')" id="tab_comments_remarks_<%= @actable.id %>" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
    Comments & Remarks
    <span class="ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs font-medium">
      <%= comments_remarks_count %>
    </span>
  </button>
<% end %>

<%= turbo_stream.replace "tab_next_steps_#{@actable.id}" do %>
  <button onclick="showTab('next_steps_<%= @actable.id %>')" id="tab_next_steps_<%= @actable.id %>" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
    Next Steps
    <span class="ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs font-medium">
      <%= next_steps_count %>
    </span>
  </button>
<% end %>

<%= turbo_stream.replace "tab_internal_notes_<%= @actable.id %>" do %>
  <button onclick="showTab('internal_notes_<%= @actable.id %>')" id="tab_internal_notes_<%= @actable.id %>" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
    Internal Notes
    <span class="ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs font-medium">
      <%= internal_notes_count %>
    </span>
  </button>
<% end %>

<%# If no activities left, show empty message %>
<% if remaining_activities.count == 0 %>
  <%= turbo_stream.replace "activities_list_container_#{@actable.id}" do %>
    <%= render "forefront/activities/list", activities: [], actable: @actable %>
  <% end %>
<% end %>

