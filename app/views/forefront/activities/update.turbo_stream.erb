<%# Determine which tab list the activity belongs to %>
<% list_id = if @activity.comment? || @activity.remark?
    "activities_list_#{@actable.id}_comments"
  elsif @activity.next_step?
    "activities_list_#{@actable.id}_next_steps"
  else
    "activities_list_#{@actable.id}_internal_notes"
  end %>

<%= turbo_stream.replace "activity_#{@activity.id}" do %>
  <% tab_activities = @activities.select { |a| 
    (@activity.comment? || @activity.remark?) ? (a.comment? || a.remark?) :
    @activity.next_step? ? a.next_step? : a.internal_note?
  } %>
  <% index = tab_activities.index(@activity) || 0 %>
  <%= render "forefront/activities/activity", activity: @activity, index: index, total: tab_activities.length, actable: @actable %>
<% end %>

<%= turbo_stream.remove "activity_edit_form_#{@activity.id}" %>

<%= turbo_stream.append "flash_messages" do %>
  <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline">Activity was successfully updated.</span>
    <button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.remove()">
      <span class="sr-only">Dismiss</span>
      <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
<% end %>

